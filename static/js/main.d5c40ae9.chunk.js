(this.webpackJsonpwrite=this.webpackJsonpwrite||[]).push([[0],{187:function(e,t,n){},188:function(e,t,n){},189:function(e,t,n){},190:function(e,t,n){},191:function(e,t,n){"use strict";n.r(t);var a=n(1),o=n.n(a),r=n(14),c=n.n(r),i=n(25),s=n(15),d=n(38),l=n(39),u=n(41),h=n(40),m=n(26),f=n(42),p=n(11),g=n(10),v=(n(187),function(e){var t=e.documents,n=e.index;return o.a.createElement("ul",{className:"Loader"},t.map((function(e,t){return o.a.createElement("li",{key:e,className:t===n?"highlighted":""},e)})))}),w=(n(188),function(e){function t(){var e,n;Object(d.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(u.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(o)))).Editors=[],n.handleContainerClick=function(e,t){n.Editors[t].focus()},n}return Object(f.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.className,a=void 0===n?"":n,r=t.cX,c=t.cY,i=t.editors,s=t.lastFocus,d=t.onChange;return o.a.createElement("div",{className:"Workspace ".concat(a)},i.map((function(t,n){var a=t.x,i=t.y,l=t.editorProps,u=t.editorState;return(o.a.createElement("div",{className:"Workspace-editor".concat(s===n?" focused":""),key:n,onClick:function(t){return e.handleContainerClick(t,n)},style:{left:r+a,top:c+i}},o.a.createElement(g.Editor,Object.assign({},l,{editorState:u,onChange:function(e){return d(e,n)},ref:function(t){return e.Editors[n]=t}}))))})))}}]),t}(a.Component)),S=["mossy","moonlit","foggy","distant","silent","soothing"],b=["brook","meadow","forest","plane","desert","oasis"];function E(){for(var e=S.length,t=b.length,n=Math.floor(Math.random()*e),a=Math.floor(Math.random()*t),o=0;o<e;++o)for(var r=0;r<t;++r){var c=b[(a+r)%t],i="".concat(S[(n+o)%e],"-").concat(c);if(!window.localStorage.getItem(i))return i}var s="".concat(S[n],"-").concat(b[a]),d=0,l=1;do{d="".concat(s,"-").concat(++l)}while(!window.localStorage.getItem(d));return d}var y=["Hello","Ready","Go on"];function O(){return y[Math.floor(Math.random()*y.length)]}n(189);var k=g.EditorState.moveFocusToEnd,j=Object.freeze({CONTROL:"control",INSERT:"insert",LOAD:"load"}),C=Object.freeze({DELETE:"delete",CONTROL:"control"}),x={delete:["Delete? y/N",function(e){var t=this;switch(e.key){case"y":case"Y":localStorage.removeItem(this.state.documents[this.state.loadIndex]),this.setState((function(e){var n=e.documents,a=e.loadIndex,o=[].concat(Object(p.a)(n.slice(0,a)),Object(p.a)(n.slice(a+1))),r=Math.max(0,Math.min(a,n.length-2));return{documents:o,editors:t.getEditors(o[r]),notice:null,loadIndex:r}}));break;case"n":case"N":case"Enter":this.setState({notice:null})}}],control:["Control mode"]},N=function(e){function t(){var e,n;Object(d.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(u.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(o)))).state={cX:0,cY:0,documents:[],editors:[],gridGap:null,hash:null,keyStates:{},lastFocus:0,loadIndex:0,mode:j.INSERT,notice:null,showGrid:!1},n.measure=function(){var e=c.a.findDOMNode(n.Container),t=e.clientWidth/2,a=e.clientHeight/2;n.setState({cX:t,cY:a})},n.getEditors=function(e){var t=window.localStorage.getItem(e);return t?JSON.parse(t).map((function(e){var t=e.x,n=e.y,a=e.editorRawContent;return{x:t,y:n,editorProps:{textAlignment:"center"},editorState:k(g.EditorState.createWithContent(Object(g.convertFromRaw)(a)))}})):[{x:0,y:0,editorProps:{textAlignment:"center"},editorState:k(g.EditorState.createWithContent(g.ContentState.createFromText("".concat(O(),"."))))}]},n.load=function(e){document.title="Write | "+e.split("-").map((function(e){return e[0].toUpperCase()+e.slice(1)})).join(" "),n.setState({hash:e,editors:n.getEditors(e),mode:j.INSERT})},n.handleHashChange=function(){var e=window.location.hash;e?n.load(e.slice(1)):n.createNewDocument()},n.createNewDocument=function(){var e=E();window.history.pushState(null,null,"#".concat(e)),n.load(e)},n.handleClick=function(e){var t=e.metaKey,a=e.pageX,o=e.pageY;if(t)n.setState((function(e){var t=e.cX,n=e.cY,r=e.editors,c=e.gridGap,i=e.lastFocus;return{editors:[].concat(Object(p.a)(r),[{x:Math.round((a-t)/c)*c,y:Math.round((o-n)/c)*c,editorProps:Object(s.a)({},r[i].editorProps),editorState:k(g.EditorState.createEmpty())}]),lastFocus:r.length}}));else if(!n.state.editors.some((function(e){return e.editorState.getSelection().getHasFocus()}))){var r=Object(m.a)(n).Container,c=(r=void 0===r?{}:r).Editors,i=void 0===c?[]:c;i.length&&i[0].focus()}},n.handleChange=function(e,t){var a=n.state,o=a.hash,r=a.editors,c=a.lastFocus,i=[].concat(Object(p.a)(r.slice(0,t)),[Object(s.a)({},r[t],{editorState:e})],Object(p.a)(r.slice(t+1))).filter((function(e){var n=e.editorState;return n.getSelection().getHasFocus()||n.getCurrentContent().hasText()||c===t})),d=JSON.stringify(i.map((function(n,a){var o=n.x,r=n.y,c=n.editorState;return{x:o,y:r,editorRawContent:Object(g.convertToRaw)((t===a?e:c).getCurrentContent())}})));window.localStorage.setItem(o,d),n.setState({editors:i,lastFocus:t})},n.handleKeyup=function(e){var t=e.key;n.setState({keyStates:Object(s.a)({},n.state.keyStates,Object(i.a)({},t,!1))})},n.handleKeydown=function(e){var t=e.key,a=e.metaKey;if(!e.repeat){var o=n.state,r=o.documents,c=o.keyStates,d=o.loadIndex,l=o.mode,u=o.notice;if(n.setState({keyStates:Object(s.a)({},c,Object(i.a)({},t,!0))}),u&&x[u][1])x[u][1].call(Object(m.a)(n),e),a||(e.preventDefault(),e.stopPropagation());else if(l===j.LOAD){switch(t){case"ArrowUp":n.setState((function(e){var t=e.documents,a=e.loadIndex,o=(t.length+a-1)%t.length;return{loadIndex:o,editors:n.getEditors(t[o])}}));break;case"ArrowDown":n.setState((function(e){var t=e.documents,a=(e.loadIndex+1)%t.length;return{loadIndex:a,editors:n.getEditors(t[a])}}));break;case"Enter":var h=r[d];window.history.pushState(null,null,"#".concat(h)),n.load(h),n.setState({mode:j.INSERT});break;case"ArrowRight":break;case"c":case"C":break;case"d":case"D":n.setState({notice:C.DELETE});break;case"r":case"R":break;case"q":case"Q":n.setState({mode:j.INSERT})}a||(console.log("Prevented a ".concat(t)),e.preventDefault(),e.stopPropagation())}else if(l!==j.CONTROL||a)a&&"e"===t.toLowerCase()&&n.setState((function(e){var t=e.mode;return{mode:{insert:j.CONTROL,control:j.INSERT}[t]||t}}));else{switch(t){case"ArrowLeft":n.setState((function(e){var t=e.editors,n=e.lastFocus,a=t[n];return{editors:[].concat(Object(p.a)(t.slice(0,n)),[Object(s.a)({},a,{editorProps:Object(s.a)({},a.editorProps,{textAlignment:"right"===a.editorProps.textAlignment?"center":"left"})})],Object(p.a)(t.slice(n+1))),mode:j.INSERT}}));break;case"ArrowRight":n.setState((function(e){var t=e.editors,n=e.lastFocus,a=t[n];return{editors:[].concat(Object(p.a)(t.slice(0,n)),[Object(s.a)({},a,{editorProps:Object(s.a)({},a.editorProps,{textAlignment:"left"===a.editorProps.textAlignment?"center":"right"})})],Object(p.a)(t.slice(n+1))),mode:j.INSERT}}));break;case"g":case"G":n.setState((function(e){var t=e.showGrid;return{mode:j.INSERT,showGrid:!t}}));break;case"n":case"N":n.createNewDocument();break;case"o":case"O":n.setState((function(){var e=Object.keys(localStorage),t=window.location.hash&&window.location.hash.slice(1);return{documents:e,loadIndex:Math.max(0,e.indexOf(t)),mode:j.LOAD}}));break;default:return void n.setState({mode:j.INSERT})}e.preventDefault(),e.stopPropagation()}}},n}return Object(f.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){window.addEventListener("click",this.handleClick),window.addEventListener("hashchange",this.handleHashChange),window.addEventListener("resize",this.measure),window.addEventListener("keydown",this.handleKeydown),window.addEventListener("keyup",this.handleKeyup),this.handleHashChange()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("click",this.handleClick),window.removeEventListener("hashchange",this.handleHashChange),window.removeEventListener("resize",this.measure),window.removeEventListener("keydown",this.handleKeydown),window.removeEventListener("keyup",this.handleKeyup)}},{key:"componentDidUpdate",value:function(e,t){if("number"!==typeof this.state.gridGap&&this.GridProbe){var n=c.a.findDOMNode(this.GridProbe).offsetWidth/1e4*2;document.documentElement.style.setProperty("--grid-gap","".concat(n,"px")),this.setState({gridGap:n})}else"number"!==typeof t.gridGap&&this.measure()}},{key:"render",value:function(){var e=this,t=this.state,n=t.cX,a=t.cY,r=t.documents,c=t.editors,i=t.gridGap,s=t.hash,d=t.keyStates,l=t.lastFocus,u=t.loadIndex,h=t.mode,m=t.notice,f=t.showGrid,p="number"===typeof i;return o.a.createElement("div",{className:"App".concat(p&&(f||"control"===h||d.Meta)?" show-grid":""," control-mode-").concat("control"===h?"on":"off"),style:p?{backgroundSize:"".concat(i,"px ").concat(i,"px"),lineHeight:"".concat(i,"px")}:{}},s&&(p?o.a.createElement(o.a.Fragment,null,h===j.LOAD&&o.a.createElement(v,{documents:r,index:u}),m&&o.a.createElement("p",null,o.a.createElement("strong",{className:"App-notice"},x[m][0])),o.a.createElement(w,{cX:n,cY:a,editors:c,lastFocus:l,onChange:this.handleChange,ref:function(t){return e.Container=t}})):o.a.createElement("span",{className:"Grid-probe",ref:function(t){return e.GridProbe=t}},new Array(1e4).fill("0").join(""))))}}]),t}(a.Component);n(190);c.a.render(o.a.createElement(N,null),document.getElementById("root"))},89:function(e,t,n){e.exports=n(191)}},[[89,1,2]]]);
//# sourceMappingURL=main.d5c40ae9.chunk.js.map